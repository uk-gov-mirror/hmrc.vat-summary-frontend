@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import config.AppConfig
@import models.viewModels.PaymentsHistoryModel

@this(govukTable: GovukTable,
      paymentsHistoryCharge: PaymentsHistoryCharge)

@(years: Seq[Int],
  transactions: Seq[PaymentsHistoryModel],
  showPreviousPaymentsTab: Boolean
  )(implicit messages: Messages, appConfig: AppConfig, user: User)

@for(year <- years) {
  <div id="@year" class="govuk-tabs__panel@if(year != years.head) { govuk-tabs__panel--hidden}">
    <h2 class="govuk-heading-m">@year</h2>
    @if(transactions.exists(_.clearedDate.getOrElse("").toString.contains(year.toString))) {
    <table class="govuk-table">
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th class="govuk-table__header govuk-visually-hidden" scope="col">
            @messages("paymentsHistory.paymentReceivedTitle")
          </th>

          <th class="govuk-table__header govuk-visually-hidden" scope="col">
            @messages("paymentsHistory.descriptionTitle")
          </th>

          <th scope="col" class="numeric govuk-table__header govuk-visually-hidden">
            @messages("paymentsHistory.amountTitle")
          </th>
        </tr>
      </thead>

      <tbody class="govuk-table__body">
        @for(transaction <- transactions.filter(_.clearedDate.getOrElse("").toString.contains(year.toString))) {
          @paymentsHistoryCharge(transaction)
        }
      </tbody>
    </table>

    } else {
      <p class="govuk-body">@messages("paymentsHistory.noCurrentYearHistory")</p>
    }
    </div>
}

@if(showPreviousPaymentsTab) {
  <div id="previous-payments" class="govuk-tabs__panel">
    <h2 class="govuk-heading-m">@messages("paymentsHistory.previousPayments.heading")</h2>
    <p class="govuk-body">
      @messages("paymentsHistory.previousPayments.youCan")
      <a class="govuk-link" href="@appConfig.portalNonHybridPreviousPaymentsUrl(user.vrn)">
        @messages("paymentsHistory.previousPayments.viewPreviousPayments")
      </a>
      @messages("paymentsHistory.previousPayments.beforeMtd")
    </p>
  </div>
}
